#include <stdio.h>
#include "./SDL2/SDL.h"
#include "./SDL2/SDL_image.h"
#undef main

int main(int argc, char** argv) {
    // Initialize SDL
    if (SDL_Init(SDL_INIT_VIDEO) < 0) {
        fprintf(stderr, "Failed to initialize SDL: %s\n", SDL_GetError());
        return 1;
    }

    // Initialize SDL_image
    if (IMG_Init(IMG_INIT_PNG) != IMG_INIT_PNG) {
        fprintf(stderr, "Failed to initialize SDL_image: %s\n", IMG_GetError());
        SDL_Quit();
        return 1;
    }

    // Create window
    SDL_Window* window = SDL_CreateWindow("SDL Image Example", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 720, 480, SDL_WINDOW_SHOWN);
    if (!window) {
        fprintf(stderr, "Failed to create window: %s\n", SDL_GetError());
        IMG_Quit();
        SDL_Quit();
        return 1;
    }

    // Create renderer
    SDL_Renderer* renderer = SDL_CreateRenderer(window, -1, SDL_RENDERER_ACCELERATED);
    if (!renderer) {
        fprintf(stderr, "Failed to create renderer: %s\n", SDL_GetError());
        SDL_DestroyWindow(window);
        IMG_Quit();
        SDL_Quit();
        return 1;
    }

    SDL_Texture* imageTexture1 = IMG_LoadTexture(renderer, "backpack2.png");
    if (!imageTexture1) {
        fprintf(stderr, "Failed to load image 1: %s\n", IMG_GetError());
        SDL_DestroyRenderer(renderer);
        SDL_DestroyWindow(window);
        IMG_Quit();
        SDL_Quit();
        return 1;
    }
    SDL_Rect destRect1;
    // Set the destination rectangle for image 1
    destRect1.x = 180;  // x-coordinate of the destination rectangle
    destRect1.y = 140;  // y-coordinate of the destination rectangle
    destRect1.w = 400;  // width of the destination rectangle
    destRect1.h = 200;  // height of the destination rectangle


    int i = 0;
    int j = 0;
    // Load image 1 as texture
    if(){
        for(int i = 0; i < 30; i++){
        SDL_Texture* imageTexture[i] = IMG_LoadTexture(renderer, "image.png");
        if (!imageTexture[i]) {
            fprintf(stderr, "Failed to load image 2: %s\n", IMG_GetError());
            SDL_DestroyTexture(imageTexture1);
            SDL_DestroyRenderer(renderer);
            SDL_DestroyWindow(window);
            IMG_Quit();
            SDL_Quit();
            return 1;
        }
        }
    // Set the destination rectangle for image 2
    SDL_Rect destRect[27];
    SDL_Rect destRect_hot_key[9];
    destRect[i].x = 204 + 41.246*(i%9);  // x-coordinate of the destination rectangle
    destRect[i].y = 158 + 42*(i/9);  // y-coordinate of the destination rectangle
    destRect[i].w = 25;  // width of the destination rectangle
    destRect[i++].h = 25;  // height of the destination rectangle
        if(j < 9){
            destRect_hot_key[j].x = 204 + 41.246 * ( j % 9 );  // x-coordinate of the destination rectangle
            destRect_hot_key[j].y = 158 + 135;  // y-coordinate of the destination rectangle
            destRect_hot_key[j].w = 25;  // width of the destination rectangle
            destRect_hot_key[j++].h = 25;  // height of the destination rectangle
        }
    }
    // Load image 2 as texture

    // Set initial texture visibility
    int texture1Visible = 1;

    int textureVisible[30] = {0};
    for (int i = 0; i < 30; i++){
        textureVisible[i] = 1;
    }
    // Main loop
    SDL_Event event;
    while (SDL_WaitEvent(&event)) {
        switch (event.type) {
            case SDL_QUIT:
                goto end;
            case SDL_KEYDOWN:
                if (event.key.keysym.sym == SDLK_e) {
                    // Toggle texture 1 visibility
                    texture1Visible = !texture1Visible;
                    for (int i = 0; i < 30; i++){
                        textureVisible[i] = !textureVisible[i];   
                    }
                }
                break;
        }

        // Clear renderer
        SDL_RenderClear(renderer);
        if (texture1Visible) {
            // Copy texture 1 to renderer
            SDL_RenderCopy(renderer, imageTexture1, NULL, &destRect1);
        }        
        for(int i = 0; i < 30; i++){
            if (textureVisible[i]){
             // Copy texture 1 to renderer
             SDL_RenderCopy(renderer, imageTexture[i], NULL, &destRect[i]);
            }
        }
        // Update renderer
        SDL_RenderPresent(renderer);
    }

end:
    // Destroy textures, renderer, and window
    SDL_DestroyTexture(imageTexture1);
    for(int i = 0; i < 30; i++){
        SDL_DestroyTexture(imageTexture[i]);
        }
    SDL_DestroyRenderer(renderer);
    SDL_DestroyWindow(window);

    // Quit SDL_image and SDL
    IMG_Quit();
    SDL_Quit();

    return 0;
}
